module Tests

open NUnit.Framework
open FsUnit
open Waterloo.Bingoal
open Waterloo.Napoleon
open WaterlooModule

let ``Given Napoleon feed`` =
    let feed = NapoleonFeed.Convert "{\"liveEvents\":[{\"event\":{\"id\":1002486916,\"name\":\"Eintracht Frankfurt U19 - Mainz 05 U19\",\"homeName\":\"Eintracht Frankfurt U19\",\"awayName\":\"Mainz 05 U19\",\"start\":\"2015-02-08T10:00Z\",\"group\":\"A-Junioren-Bundesliga SÃ¼d/SÃ¼dwest\",\"type\":\"ET_MATCH\",\"liveBetOffers\":true,\"openForLiveBetting\":true,\"boUri\":\"/offering/api/v2/ngbe/betoffer/live/event/1002486916.json\",\"groupId\":2000053832,\"hideStartNo\":true,\"sportId\":1000093190,\"sport\":\"FOOTBALL\",\"path\":[{\"id\":1000093190,\"name\":\"Football\",\"englishName\":\"Football\"},{\"id\":1000461728,\"name\":\"Germany\",\"englishName\":\"Germany\"},{\"id\":2000053832,\"name\":\"A-Junioren-Bundesliga SÃ¼d/SÃ¼dwest\",\"englishName\":\"A-Junioren-Bundesliga SÃ¼d/SÃ¼dwest\"}],\"englishName\":\"Eintracht Frankfurt U19 - Mainz 05 U19\",\"state\":\"STARTED\"},\"liveData\":{\"eventId\":1002486916,\"matchClock\":{\"minute\":24,\"second\":41,\"period\":\"1st half\",\"running\":true},\"score\":{\"home\":\"0\",\"away\":\"0\",\"who\":\"UNKNOWN\"},\"statistics\":{\"football\":{\"home\":{\"yellowCards\":0,\"redCards\":0,\"corners\":2},\"away\":{\"yellowCards\":1,\"redCards\":0,\"corners\":0}}},\"open\":true},\"mainBetOffer\":{\"id\":2011786947,\"live\":true,\"criterion\":{\"id\":1001159858,\"label\":\"Full Time\"},\"betOfferType\":{\"id\":2,\"name\":\"Match\"},\"eventId\":1002486916,\"pba\":{\"disabled\":true,\"status\":\"The stake for this bet offer is limited. It is not possible to ask for a higher stake.\"},\"cashIn\":true,\"outcomes\":[{\"id\":2044364943,\"label\":\"1\",\"odds\":3400,\"type\":\"OT_ONE\",\"betOfferId\":2011786947,\"changedDate\":\"2015-02-08T10:29:23Z\",\"oddsFractional\":\"12/5\",\"oddsAmerican\":\"240\"},{\"id\":2044364945,\"label\":\"X\",\"odds\":3550,\"type\":\"OT_CROSS\",\"betOfferId\":2011786947,\"changedDate\":\"2015-02-08T10:28:52Z\",\"oddsFractional\":\"51/20\",\"oddsAmerican\":\"255\"},{\"id\":2044364947,\"label\":\"2\",\"odds\":2020,\"type\":\"OT_TWO\",\"betOfferId\":2011786947,\"changedDate\":\"2015-02-08T10:28:57Z\",\"oddsFractional\":\"51/50\",\"oddsAmerican\":\"102\"}],\"main\":true,\"categoryName\":\"First Slot\"}},{\"event\":{\"id\":1002487238,\"name\":\"Lazio U20 - Juventus U20\",\"homeName\":\"Lazio U20\",\"awayName\":\"Juventus U20\",\"start\":\"2015-02-08T10:00Z\",\"group\":\"Coppa Primavera\",\"type\":\"ET_MATCH\",\"liveBetOffers\":true,\"openForLiveBetting\":true,\"boUri\":\"/offering/api/v2/ngbe/betoffer/live/event/1002487238.json\",\"groupId\":2000054381,\"hideStartNo\":true,\"sportId\":1000093190,\"sport\":\"FOOTBALL\",\"path\":[{\"id\":1000093190,\"name\":\"Football\",\"englishName\":\"Football\"},{\"id\":1000461745,\"name\":\"Italy\",\"englishName\":\"Italy\"},{\"id\":2000054381,\"name\":\"Coppa Primavera\",\"englishName\":\"Coppa Primavera\"}],\"englishName\":\"Lazio U20 - Juventus U20\",\"state\":\"STARTED\"},\"liveData\":{\"eventId\":1002487238,\"matchClock\":{\"minute\":27,\"second\":28,\"period\":\"1st half\",\"running\":true},\"score\":{\"home\":\"1\",\"away\":\"0\",\"who\":\"UNKNOWN\"},\"statistics\":{\"football\":{\"home\":{\"yellowCards\":1,\"redCards\":0,\"corners\":1},\"away\":{\"yellowCards\":0,\"redCards\":0,\"corners\":3}}},\"open\":true},\"mainBetOffer\":{\"id\":2011785264,\"live\":true,\"criterion\":{\"id\":1001159858,\"label\":\"Full Time\"},\"betOfferType\":{\"id\":2,\"name\":\"Match\"},\"eventId\":1002487238,\"pba\":{\"disabled\":true,\"status\":\"The stake for this bet offer is limited. It is not possible to ask for a higher stake.\"},\"cashIn\":true,\"outcomes\":[{\"id\":2044359679,\"label\":\"1\",\"odds\":1630,\"type\":\"OT_ONE\",\"betOfferId\":2011785264,\"changedDate\":\"2015-02-08T10:27:00Z\",\"oddsFractional\":\"5/8\",\"oddsAmerican\":\"-159\"},{\"id\":2044359682,\"label\":\"X\",\"odds\":3850,\"type\":\"OT_CROSS\",\"betOfferId\":2011785264,\"changedDate\":\"2015-02-08T10:27:00Z\",\"oddsFractional\":\"14/5\",\"oddsAmerican\":\"285\"},{\"id\":2044359683,\"label\":\"2\",\"odds\":4700,\"type\":\"OT_TWO\",\"betOfferId\":2011785264,\"changedDate\":\"2015-02-08T10:27:00Z\",\"oddsFractional\":\"37/10\",\"oddsAmerican\":\"370\"}],\"main\":true,\"categoryName\":\"First Slot\"}},{\"event\":{\"id\":1002487494,\"name\":\"ECU Joondalup SC - Cockburn City SC\",\"homeName\":\"ECU Joondalup SC\",\"awayName\":\"Cockburn City SC\",\"start\":\"2015-02-08T09:00Z\",\"group\":\"Matches\",\"type\":\"ET_MATCH\",\"liveBetOffers\":true,\"openForLiveBetting\":true,\"boUri\":\"/offering/api/v2/ngbe/betoffer/live/event/1002487494.json\",\"groupId\":1000167902,\"hideStartNo\":true,\"sportId\":1000093190,\"sport\":\"FOOTBALL\",\"path\":[{\"id\":1000093190,\"name\":\"Football\",\"englishName\":\"Football\"},{\"id\":1000093393,\"name\":\"Club Friendlies\",\"englishName\":\"Club Friendlies\"},{\"id\":1000167902,\"name\":\"Matches\",\"englishName\":\"Matches\"}],\"englishName\":\"ECU Joondalup SC - Cockburn City SC\",\"state\":\"STARTED\"},\"liveData\":{\"eventId\":1002487494,\"matchClock\":{\"minute\":70,\"second\":56,\"period\":\"2nd half\",\"running\":true},\"score\":{\"home\":\"0\",\"away\":\"2\",\"info\":\"HT: 0-0\",\"who\":\"AWAY\"},\"statistics\":{\"football\":{\"home\":{\"yellowCards\":1,\"redCards\":0,\"corners\":1},\"away\":{\"yellowCards\":0,\"redCards\":0,\"corners\":4}}},\"open\":true},\"mainBetOffer\":{\"id\":2011785589,\"live\":true,\"criterion\":{\"id\":1001159858,\"label\":\"Full Time\"},\"betOfferType\":{\"id\":2,\"name\":\"Match\"},\"eventId\":1002487494,\"pba\":{\"disabled\":true,\"status\":\"The stake for this bet offer is limited. It is not possible to ask for a higher stake.\"},\"cashIn\":true,\"outcomes\":[{\"id\":2044360697,\"label\":\"1\",\"odds\":60000,\"type\":\"OT_ONE\",\"betOfferId\":2011785589,\"changedDate\":\"2015-02-08T10:25:16Z\",\"oddsFractional\":\"55/1\",\"oddsAmerican\":\"5900\"},{\"id\":2044360698,\"label\":\"X\",\"odds\":16000,\"type\":\"OT_CROSS\",\"betOfferId\":2011785589,\"changedDate\":\"2015-02-08T10:25:16Z\",\"oddsFractional\":\"15/1\",\"oddsAmerican\":\"1500\"},{\"id\":2044360699,\"label\":\"2\",\"odds\":1020,\"type\":\"OT_TWO\",\"betOfferId\":2011785589,\"changedDate\":\"2015-02-08T10:25:16Z\",\"oddsFractional\":\"1/50\",\"oddsAmerican\":\"-5000\"}],\"main\":true,\"categoryName\":\"First Slot\"}},{\"event\":{\"id\":1002485822,\"name\":\"Sioni Bolnisi - Amkar Perm\",\"homeName\":\"Sioni Bolnisi\",\"awayName\":\"Amkar Perm\",\"start\":\"2015-02-08T09:00Z\",\"group\":\"Matches\",\"type\":\"ET_MATCH\",\"liveBetOffers\":true,\"openForLiveBetting\":true,\"boUri\":\"/offering/api/v2/ngbe/betoffer/live/event/1002485822.json\",\"groupId\":1000167902,\"hideStartNo\":true,\"sportId\":1000093190,\"sport\":\"FOOTBALL\",\"path\":[{\"id\":1000093190,\"name\":\"Football\",\"englishName\":\"Football\"},{\"id\":1000093393,\"name\":\"Club Friendlies\",\"englishName\":\"Club Friendlies\"},{\"id\":1000167902,\"name\":\"Matches\",\"englishName\":\"Matches\"}],\"englishName\":\"Sioni Bolnisi - Amkar Perm\",\"state\":\"FINISHED\"},\"liveData\":{\"eventId\":1002485822,\"matchClock\":{\"minute\":82,\"second\":7,\"period\":\"2nd half\",\"running\":true},\"score\":{\"home\":\"0\",\"away\":\"0\",\"info\":\"HT 0-0\",\"who\":\"UNKNOWN\"},\"statistics\":{\"football\":{\"home\":{\"yellowCards\":1,\"redCards\":0,\"corners\":0},\"away\":{\"yellowCards\":0,\"redCards\":0,\"corners\":0}}},\"open\":true},\"mainBetOffer\":{\"id\":2011786049,\"live\":true,\"criterion\":{\"id\":1001159858,\"label\":\"Full Time\"},\"betOfferType\":{\"id\":2,\"name\":\"Match\"},\"eventId\":1002485822,\"pba\":{\"disabled\":true,\"status\":\"The stake for this bet offer is limited. It is not possible to ask for a higher stake.\"},\"cashIn\":true,\"outcomes\":[{\"id\":2044361985,\"label\":\"1\",\"odds\":9000,\"type\":\"OT_ONE\",\"betOfferId\":2011786049,\"changedDate\":\"2015-02-08T10:29:18Z\",\"oddsFractional\":\"8/1\",\"oddsAmerican\":\"800\"},{\"id\":2044361987,\"label\":\"X\",\"odds\":1270,\"type\":\"OT_CROSS\",\"betOfferId\":2011786049,\"changedDate\":\"2015-02-08T10:28:13Z\",\"oddsFractional\":\"27/100\",\"oddsAmerican\":\"-385\"},{\"id\":2044361989,\"label\":\"2\",\"odds\":5600,\"type\":\"OT_TWO\",\"betOfferId\":2011786049,\"changedDate\":\"2015-02-08T10:29:03Z\",\"oddsFractional\":\"23/5\",\"oddsAmerican\":\"460\"}],\"main\":true}},{\"event\":{\"id\":1002460188,\"name\":\"Than Quang Ninh - Thanh Hoa\",\"homeName\":\"Than Quang Ninh\",\"awayName\":\"Thanh Hoa\",\"start\":\"2015-02-08T09:00Z\",\"group\":\"V-League\",\"type\":\"ET_MATCH\",\"liveBetOffers\":true,\"openForLiveBetting\":true,\"boUri\":\"/offering/api/v2/ngbe/betoffer/live/event/1002460188.json\",\"groupId\":2000055534,\"hideStartNo\":true,\"sportId\":1000093190,\"sport\":\"FOOTBALL\",\"path\":[{\"id\":1000093190,\"name\":\"Football\",\"englishName\":\"Football\"},{\"id\":2000055356,\"name\":\"Vietnam\",\"englishName\":\"Vietnam\"},{\"id\":2000055534,\"name\":\"V-League\",\"englishName\":\"V-League\"}],\"englishName\":\"Than Quang Ninh - Thanh Hoa\",\"state\":\"STARTED\"},\"liveData\":{\"eventId\":1002460188,\"matchClock\":{\"minute\":69,\"second\":53,\"period\":\"2nd half\",\"running\":true},\"score\":{\"home\":\"0\",\"away\":\"1\",\"info\":\"HT 0-0\",\"who\":\"UNKNOWN\"},\"statistics\":{\"football\":{\"home\":{\"yellowCards\":4,\"redCards\":0,\"corners\":5},\"away\":{\"yellowCards\":4,\"redCards\":0,\"corners\":1}}},\"open\":true},\"mainBetOffer\":{\"id\":2011785542,\"live\":true,\"criterion\":{\"id\":1001159858,\"label\":\"Full Time\"},\"betOfferType\":{\"id\":2,\"name\":\"Match\"},\"eventId\":1002460188,\"pba\":{\"disabled\":true,\"status\":\"The stake for this bet offer is limited. It is not possible to ask for a higher stake.\"},\"cashIn\":true,\"outcomes\":[{\"id\":2044360533,\"label\":\"1\",\"odds\":6500,\"type\":\"OT_ONE\",\"betOfferId\":2011785542,\"changedDate\":\"2015-02-08T10:29:24Z\",\"oddsFractional\":\"11/2\",\"oddsAmerican\":\"550\"},{\"id\":2044360534,\"label\":\"X\",\"odds\":3200,\"type\":\"OT_CROSS\",\"betOfferId\":2011785542,\"changedDate\":\"2015-02-08T10:29:24Z\",\"oddsFractional\":\"11/5\",\"oddsAmerican\":\"220\"},{\"id\":2044360535,\"label\":\"2\",\"odds\":1600,\"type\":\"OT_TWO\",\"betOfferId\":2011785542,\"changedDate\":\"2015-02-08T10:29:24Z\",\"oddsFractional\":\"3/5\",\"oddsAmerican\":\"-167\"}],\"main\":true,\"categoryName\":\"First Slot\"}},{\"event\":{\"id\":1002488972,\"name\":\"Halep, Simona - Muguruza, GarbiÃ±e\",\"homeName\":\"Halep, Simona\",\"awayName\":\"Muguruza Blanco, Garbine\",\"start\":\"2015-02-08T10:00Z\",\"group\":\"Singles\",\"type\":\"ET_MATCH\",\"liveBetOffers\":true,\"openForLiveBetting\":true,\"boUri\":\"/offering/api/v2/ngbe/betoffer/live/event/1002488972.json\",\"groupId\":1000304845,\"hideStartNo\":true,\"sportId\":1000093193,\"sport\":\"TENNIS\",\"path\":[{\"id\":1000093193,\"name\":\"Tennis\",\"englishName\":\"Tennis\"},{\"id\":1000093488,\"name\":\"Fed Cup\",\"englishName\":\"Fed Cup\"},{\"id\":1000304845,\"name\":\"Singles\",\"englishName\":\"Singles\"}],\"englishName\":\"Halep, Simona - Muguruza, GarbiÃ±e\",\"state\":\"STARTED\"},\"liveData\":{\"eventId\":1002488972,\"matchClock\":{\"minute\":20,\"second\":56,\"running\":true},\"score\":{\"home\":\"30\",\"away\":\"30\",\"who\":\"UNKNOWN\"},\"statistics\":{\"sets\":{\"home\":[1,-1,-1],\"away\":[5,-1,-1],\"homeServe\":true}},\"open\":true},\"mainBetOffer\":{\"id\":2011787186,\"live\":true,\"criterion\":{\"id\":1001159551,\"label\":\"Match Odds\"},\"betOfferType\":{\"id\":2,\"name\":\"Match\"},\"eventId\":1002488972,\"pba\":{\"disabled\":true,\"status\":\"The stake for this bet offer is limited. It is not possible to ask for a higher stake.\"},\"cashIn\":true,\"outcomes\":[{\"id\":2044365709,\"label\":\"1\",\"odds\":2700,\"type\":\"OT_ONE\",\"betOfferId\":2011787186,\"changedDate\":\"2015-02-08T10:29:13Z\",\"oddsFractional\":\"17/10\",\"oddsAmerican\":\"170\"},{\"id\":2044365711,\"label\":\"2\",\"odds\":1450,\"type\":\"OT_TWO\",\"betOfferId\":2011787186,\"changedDate\":\"2015-02-08T10:28:13Z\",\"oddsFractional\":\"4/9\",\"oddsAmerican\":\"-225\"}],\"main\":true,\"categoryName\":\"First Slot\"}},{\"event\":{\"id\":1002492044,\"name\":\"Benoit, M - Sanchez-Quintanar, Cristina\",\"homeName\":\"Benoit, M\",\"awayName\":\"Sanchez-Quintanar, Cristina\",\"start\":\"2015-02-08T09:00Z\",\"group\":\"El Kantaoui\",\"type\":\"ET_MATCH\",\"liveBetOffers\":true,\"openForLiveBetting\":true,\"boUri\":\"/offering/api/v2/ngbe/betoffer/live/event/1002492044.json\",\"groupId\":2000083389,\"hideStartNo\":true,\"sportId\":1000093193,\"sport\":\"TENNIS\",\"path\":[{\"id\":1000093193,\"name\":\"Tennis\",\"englishName\":\"Tennis\"},{\"id\":1000462066,\"name\":\"ITF Women\",\"englishName\":\"ITF Women\"},{\"id\":2000083389,\"name\":\"El Kantaoui\",\"englishName\":\"El Kantaoui\"}],\"englishName\":\"Benoit, M - Sanchez-Quintanar, Cristina\",\"state\":\"FINISHED\"},\"liveData\":{\"eventId\":1002492044,\"matchClock\":{\"minute\":78,\"second\":31,\"running\":true},\"score\":{\"home\":\"6\",\"away\":\"5\",\"who\":\"AWAY\"},\"statistics\":{\"sets\":{\"home\":[6,0,-1],\"away\":[6,0,-1],\"homeServe\":true}},\"open\":true},\"mainBetOffer\":{\"id\":2011786046,\"live\":true,\"criterion\":{\"id\":1001159551,\"label\":\"Match Odds\"},\"betOfferType\":{\"id\":2,\"name\":\"Match\"},\"eventId\":1002492044,\"pba\":{\"disabled\":true,\"status\":\"The stake for this bet offer is limited. It is not possible to ask for a higher stake.\"},\"cashIn\":true,\"outcomes\":[{\"id\":2044361976,\"label\":\"1\",\"odds\":1270,\"type\":\"OT_ONE\",\"betOfferId\":2011786046,\"changedDate\":\"2015-02-08T10:28:58Z\",\"oddsFractional\":\"27/100\",\"oddsAmerican\":\"-385\"},{\"id\":2044361978,\"label\":\"2\",\"odds\":3400,\"type\":\"OT_TWO\",\"betOfferId\":2011786046,\"changedDate\":\"2015-02-08T10:28:58Z\",\"oddsFractional\":\"12/5\",\"oddsAmerican\":\"240\"}],\"main\":true,\"categoryName\":\"First Slot\"}},{\"event\":{\"id\":1002492252,\"name\":\"Team Secret - Big God\",\"homeName\":\"Team Secret\",\"awayName\":\"Big God\",\"start\":\"2015-02-08T05:30Z\",\"group\":\"Asia Championships\",\"type\":\"ET_MATCH\",\"liveBetOffers\":true,\"openForLiveBetting\":true,\"boUri\":\"/offering/api/v2/ngbe/betoffer/live/event/1002492252.json\",\"groupId\":2000083950,\"hideStartNo\":true,\"sportId\":2000077768,\"sport\":\"ESPORTS\",\"path\":[{\"id\":2000077768,\"name\":\"E-Sports\",\"englishName\":\"E-Sports\"},{\"id\":2000079727,\"name\":\"Dota 2\",\"englishName\":\"Dota 2\"},{\"id\":2000083950,\"name\":\"Asia Championships\",\"englishName\":\"Asia Championships\"}],\"englishName\":\"Team Secret - Big God\",\"state\":\"STARTED\"},\"liveData\":{\"eventId\":1002492252,\"matchClock\":{\"minute\":0,\"second\":0,\"running\":false,\"disabled\":true},\"score\":{\"home\":\"1\",\"away\":\"1\",\"info\":\"Best of 3\",\"who\":\"AWAY\"},\"open\":true}},{\"event\":{\"id\":1002457856,\"name\":\"San Miguel Beermen - Barangay Ginebra San Miguel\",\"homeName\":\"San Miguel Beermen\",\"awayName\":\"Barangay Ginebra San Miguel\",\"start\":\"2015-02-08T09:15Z\",\"group\":\"PBA\",\"type\":\"ET_MATCH\",\"liveBetOffers\":true,\"openForLiveBetting\":true,\"boUri\":\"/offering/api/v2/ngbe/betoffer/live/event/1002457856.json\",\"groupId\":2000050269,\"hideStartNo\":true,\"sportId\":1000093204,\"sport\":\"BASKETBALL\",\"path\":[{\"id\":1000093204,\"name\":\"Basketball\",\"englishName\":\"Basketball\"},{\"id\":2000050268,\"name\":\"Philippines\",\"englishName\":\"Philippines\"},{\"id\":2000050269,\"name\":\"PBA\",\"englishName\":\"PBA\"}],\"englishName\":\"San Miguel Beermen - Barangay Ginebra San Miguel\",\"state\":\"STARTED\"},\"liveData\":{\"eventId\":1002457856,\"matchClock\":{\"minute\":24,\"second\":0,\"period\":\"3rd Quarter\",\"running\":false},\"score\":{\"home\":\"41\",\"away\":\"48\",\"info\":\"(21-27, 20-21, x-x, x-x)  \",\"who\":\"UNKNOWN\"},\"open\":true},\"mainBetOffer\":{\"id\":2011785180,\"live\":true,\"criterion\":{\"id\":1001159732,\"label\":\"Including overtime\"},\"betOfferType\":{\"id\":2,\"name\":\"Match\"},\"eventId\":1002457856,\"pba\":{\"disabled\":true,\"status\":\"The stake for this bet offer is limited. It is not possible to ask for a higher stake.\"},\"cashIn\":true,\"outcomes\":[{\"id\":2044359354,\"label\":\"1\",\"odds\":2480,\"type\":\"OT_ONE\",\"betOfferId\":2011785180,\"changedDate\":\"2015-02-08T10:27:55Z\",\"oddsFractional\":\"37/25\",\"oddsAmerican\":\"148\"},{\"id\":2044359357,\"label\":\"2\",\"odds\":1510,\"type\":\"OT_TWO\",\"betOfferId\":2011785180,\"changedDate\":\"2015-02-08T10:27:55Z\",\"oddsFractional\":\"51/100\",\"oddsAmerican\":\"-200\"}],\"main\":true,\"categoryName\":\"First Slot\"}}],\"group\":{\"id\":1,\"groups\":[{\"id\":1000093190,\"name\":\"Football\",\"englishName\":\"Football\",\"groups\":[{\"id\":1000461728,\"name\":\"Germany\",\"englishName\":\"Germany\",\"groups\":[{\"id\":2000053832,\"name\":\"A-Junioren-Bundesliga SÃ¼d/SÃ¼dwest\",\"englishName\":\"A-Junioren-Bundesliga SÃ¼d/SÃ¼dwest\",\"sport\":\"FOOTBALL\"}],\"sortOrder\":\"9\",\"sport\":\"FOOTBALL\"},{\"id\":1000461745,\"name\":\"Italy\",\"englishName\":\"Italy\",\"groups\":[{\"id\":2000054381,\"name\":\"Coppa Primavera\",\"englishName\":\"Coppa Primavera\",\"sport\":\"FOOTBALL\"}],\"sortOrder\":\"10\",\"sport\":\"FOOTBALL\"},{\"id\":1000093393,\"name\":\"Club Friendlies\",\"englishName\":\"Club Friendlies\",\"groups\":[{\"id\":1000167902,\"name\":\"Matches\",\"englishName\":\"Matches\",\"sport\":\"FOOTBALL\"}],\"sport\":\"FOOTBALL\"},{\"id\":2000055356,\"name\":\"Vietnam\",\"englishName\":\"Vietnam\",\"groups\":[{\"id\":2000055534,\"name\":\"V-League\",\"englishName\":\"V-League\",\"sport\":\"FOOTBALL\"}],\"sport\":\"FOOTBALL\"}],\"sortOrder\":\"1\",\"sport\":\"FOOTBALL\"},{\"id\":1000093193,\"name\":\"Tennis\",\"englishName\":\"Tennis\",\"groups\":[{\"id\":1000093488,\"name\":\"Fed Cup\",\"englishName\":\"Fed Cup\",\"groups\":[{\"id\":1000304845,\"name\":\"Singles\",\"englishName\":\"Singles\",\"sport\":\"TENNIS\"}],\"sortOrder\":\"50\",\"sport\":\"TENNIS\"},{\"id\":1000462066,\"name\":\"ITF Women\",\"englishName\":\"ITF Women\",\"groups\":[{\"id\":2000083389,\"name\":\"El Kantaoui\",\"englishName\":\"El Kantaoui\",\"sport\":\"TENNIS\"}],\"sortOrder\":\"80\",\"sport\":\"TENNIS\"}],\"sortOrder\":\"2\",\"sport\":\"TENNIS\"},{\"id\":1000093204,\"name\":\"Basketball\",\"englishName\":\"Basketball\",\"groups\":[{\"id\":2000050268,\"name\":\"Philippines\",\"englishName\":\"Philippines\",\"groups\":[{\"id\":2000050269,\"name\":\"PBA\",\"englishName\":\"PBA\",\"sport\":\"BASKETBALL\"}],\"sport\":\"BASKETBALL\"}],\"sortOrder\":\"5\",\"sport\":\"BASKETBALL\"},{\"id\":2000077768,\"name\":\"E-Sports\",\"englishName\":\"E-Sports\",\"groups\":[{\"id\":2000079727,\"name\":\"Dota 2\",\"englishName\":\"Dota 2\",\"groups\":[{\"id\":2000083950,\"name\":\"Asia Championships\",\"englishName\":\"Asia Championships\",\"sport\":\"ESPORTS\"}],\"sport\":\"ESPORTS\"}],\"sport\":\"ESPORTS\"}],\"sport\":\"NOT-SPECIFIED\"}}"
    convertNapoleonFeed feed
    
let ``Given Bingoal feed`` =
    let feed = BingoalFeed.Convert "{\"sports\":[{\"name\":\"Tennis\",\"sport\":\"TENNIS\",\"bets\":[{\"id\":\"1741--116\",\"time\":\"11:00\",\"flag\":\"wta\",\"name\":\"Halep, Simona - Muguruza Blanco, Garbine\",\"division\":\"Federation Cup\",\"score\":\"0:0\",\"score1\":\"0\",\"score2\":\"0\",\"tiebreak\":false,\"server\":1,\"setScore\":[{\"name\":\"1\",\"p1\":\"1\",\"p2\":\"5\"},{\"name\":\"2\",\"p1\":\"-\",\"p2\":\"-\"},{\"name\":\"3\",\"p1\":\"-\",\"p2\":\"-\"}],\"gameScore\":[{\"p1\":\"30\",\"p2\":\"30\"}],\"status\":\"Set 1\",\"started\":true,\"running\":true,\"subbets\":[{\"id\":\"2697652\",\"bettype\":44,\"options\":[{\"quot\":\"2.46\",\"active\":true,\"id\":\"1_mmm1\",\"sov\":\"-1\",\"name\":\"Halep, Simona\",\"dir\":1},{\"quot\":\"1.46\",\"active\":true,\"id\":\"2_mmm1\",\"sov\":\"-1\",\"name\":\"Muguruza Blanco, Garbine\",\"dir\":-1}],\"match\":\"1741--116\",\"title\":\"Welke speler zal de wedstrijd winnen\",\"active\":true,\"b\":2},{\"id\":\"2697661\",\"bettype\":45,\"options\":[{\"quot\":\"1.74\",\"active\":true,\"id\":\"1_2\",\"sov\":\"2\",\"name\":\"Halep, Simona\",\"dir\":1},{\"quot\":\"1.94\",\"active\":true,\"id\":\"2_2\",\"sov\":\"2\",\"name\":\"Muguruza Blanco, Garbine\",\"dir\":-1}],\"match\":\"1741--116\",\"title\":\"Welke speler wint set 2\",\"active\":true,\"b\":2},{\"id\":\"2697721\",\"bettype\":158,\"options\":[{\"quot\":\"1.95\",\"active\":true,\"id\":\"1_mmm1\",\"sov\":\"-1\",\"name\":\"Oneven\",\"dir\":1},{\"quot\":\"1.73\",\"active\":true,\"id\":\"2_mmm1\",\"sov\":\"-1\",\"name\":\"Even\",\"dir\":-1}],\"match\":\"1741--116\",\"title\":\"Oneven/Even aantal games\",\"active\":true,\"b\":2}],\"subamount\":3}]},{\"name\":\"Basketbal\",\"sport\":\"BASKET\",\"bets\":[{\"id\":\"1614--313\",\"time\":\"11:00\",\"flag\":\"wld\",\"name\":\"BC Khimki Moskou - CSKA Moskou\",\"division\":\"United League\",\"score\":\"37:26\",\"score1\":\"37\",\"score2\":\"26\",\"tiebreak\":false,\"server\":0,\"setScore\":[{\"name\":\"1\",\"p1\":\"32\",\"p2\":\"24\"},{\"name\":\"2\",\"p1\":\"-\",\"p2\":\"-\"},{\"name\":\"3\",\"p1\":\"-\",\"p2\":\"-\"},{\"name\":\"4\",\"p1\":\"-\",\"p2\":\"-\"}],\"gameScore\":[],\"status\":\"Kwart-Time 2 (<b>12'</b>)\",\"started\":true,\"running\":true,\"subbets\":[],\"subamount\":0}]}],\"betamount\":2}"
    convertBingoalFeed feed

[<Test>]
let ``Napoleon feed returns 9 events``() =    
    ``Given Napoleon feed``.Events |> Seq.length |> should equal 2

[<Test>]
let ``Napoleon feed first event is correct``() =
    let firstEvent = ``Given Napoleon feed``.Events |> Seq.nth 0

    firstEvent.Home |> should equal "Halep, Simona"
    firstEvent.Away |> should equal "Muguruza Blanco, Garbine"      

    firstEvent.Bet.Odds1 |> should equal 2700 
    firstEvent.Bet.Odds2 |> should equal 1450 

[<Test>]
let ``Bingoal feed returns 4 events``() =
    ``Given Bingoal feed``.Events |> Seq.length |> should equal 1

[<Test>]
let ``Bingoal feed first event is correct``() =
    let firstEvent = ``Given Bingoal feed``.Events |> Seq.nth 0

    firstEvent.Home |> should equal "Halep, Simona"
    firstEvent.Away |> should equal "Muguruza Blanco, Garbine"
       
    firstEvent.Bet.Odds1 |> should equal 2460 
    firstEvent.Bet.Odds2 |> should equal 1460
    
[<Test>]
let ``Match events`` () =
    let bingoalFeed = ``Given Bingoal feed``
    let napoleonFeed = ``Given Napoleon feed``

    printfn "%A" bingoalFeed
    printfn "%A" napoleonFeed

    let res = matchFeeds bingoalFeed napoleonFeed

    res |> Seq.length |> should equal 1

    let x = res |> Seq.nth 0

    x.Home |> should equal "Halep, Simona"
    x.Away |> should equal "Muguruza Blanco, Garbine"
    x.Bets |> Seq.length |> should equal 2

    let bingoalBets = x.Bets |> Seq.filter (fun x -> x.Bookie = Bookie.Bingoal) 
    let napoleonBets = x.Bets |> Seq.filter (fun x -> x.Bookie = Bookie.Napoleon)

    bingoalBets |> Seq.length |> should equal 1
    napoleonBets |> Seq.length |> should equal 1

    (bingoalBets |> Seq.nth 0).Bet |> should equal { Odds1 = 2460; Odds2 = 1460 }
    (napoleonBets |> Seq.nth 0).Bet |> should equal { Odds1 = 2700; Odds2 = 1450 }